#include <stdio.h>
#include <stdlib.h>

#define NOMEARQUIVO "ficha_gados.bin"

struct data{

   int mes,ano;

};

struct ficha_gado{

    int cod;
    float qtde_litros;
    float qtde_alimento;
    struct data data_nasc;
    char abate;

};

struct ficha_gado gados[3];

//secao de prototipos
int load_file(void);
int insert(void);
FILE * fileOpen(char nome[],char modo[]);


int main()
{
    char op;


    ImprimeTelaDeOpcoes();


    do{
        printf("\n\tOpcao: ");
        op = getch();

        switch(op){

        case '6':

            insert();

            break;
        case '1':

            load_file();
            break;
        }


    }while(op != '8');



    return 0;
}

void ImprimeTelaDeOpcoes()
{

    printf("\n\t1-Carregar dados do Arquivo\n");
    printf("\t2-Exibir a quantidade total de leite produzido por semana\n");
    printf("\t3-Exibir a quantidade total de alimento consumido por semana\n");
    printf("\t4-Exibir a quantidade total de leite que vai ser produzido por semana na fazenda, após o abate \n");
    printf("\t5-Exibir o número de cabecas de gado que irao para o abate \n");
    printf("\t6-Incluir novo registro\n");
    printf("\t7-Listar registros\n");
    printf("\t8-Sair\n");

}


int insert(){


    FILE *file = fileOpen(NOMEARQUIVO,"ab");

    printf("\n\n\tCodigo: ");
    scanf("%d",&gados[0].cod);
    printf("\tLitros: ");
    scanf("%f",&gados[0].qtde_litros);
    printf("\tAlimentacao (kg): ");
    scanf("%f",&gados[0].qtde_alimento);
    printf("\tNascimento (mes/ano): ");
    scanf("%d",&gados[0].data_nasc.mes);
    scanf("%d",&gados[0].data_nasc.ano);

    int meses=12 * 2016 + 10,idade;
    idade =  meses - (gados[0].data_nasc.mes + gados[0].data_nasc.ano * 12) ;


    if( idade > 5*12 || gados[0].qtde_litros < 40 || (gados[0].qtde_litros >= 50 && gados[0].qtde_litros <= 70 && gados[0].qtde_alimento > 50) ){

       gados[0].abate = 'S';

    }else{

       gados[0].abate = 'N';

    }

     fwrite(&gados[0],sizeof(struct ficha_gado),1,file);

    fclose(file);

}

int load_file(){

    int result=0,i;

    FILE *file = fileOpen(NOMEARQUIVO,"rb");


    result = fread(&gados[0],sizeof(struct ficha_gado),3,file);

    printf("%d",result);

    for(i=0; i < result;i++){

    printf("\n\n\tCodigo: %d ",gados[i].cod);
    printf("\n\tLitros: %.2f",gados[i].qtde_litros);
    printf("\n\tAlimento: %.2f",gados[i].qtde_alimento);
    printf("\n\tAbate: %c",gados[i].abate);
    printf("\n\tData de Nascimento: %d %d\n",gados[i].data_nasc.mes, gados[i].data_nasc.ano);

    }

fclose(file);

}



FILE* fileOpen(char nome[],char modo[]){
    FILE *fp;
    if((fp = fopen(nome,modo)) == NULL){
        printf("Erro ao abrir o arquivo <%s>",nome);
        exit(1);
    }
    return fp;
}

