#include<stdio.h>
#include<string.h>
#include<stdlib.h>
#define TAM 4


/*

2.	Devolver a quantidade total de leite produzida por semana na fazenda.
3.	Devolver a quantidade total de alimento consumido por semana na fazenda.
4.	Devolver a quantidade total de leite que vai ser produzido por semana na fazenda, após o abate
5.	Devolver número de cabeças de gado que irão para o abate.




*/


typedef struct
{
    int mes,ano;

} Nascimento;

typedef struct
{

    int codigo;
    int qtdLeite;
    int qtdAlim;
    char abate;
    Nascimento nasc;

} Gado;

int main ()
{

    Gado g;
    int opcao;
    Nascimento n;
    FILE *arq;


    ImprimeTelaDeOpcoes();

    do
    {
        opcao = EscolheOpcao();

        switch (opcao)
        {

        case 1:

            if(carregarArquivos(&arq)== 0)
            {

                printf("\n\tNao ha Gados!!\n");
            }

            break;

        case 2:

            imprimeQtdLeitePorSemana(&arq,&g);

            break;

        case 3:

            imprimeQtdAlimentoPorSemana(&arq,&g);

            break;

        case 4:

            imprimeQtdLeitePosAbate(&arq,&g);

            break;

        case 5:

            imprimeNumeroCabecasPosAbate(&arq,&g);

            break;

        case 6:

            if (incluirGados(&arq,&g)==1){

                printf("\n\tLimite excedido!!\n");

            }else{

                printf("\n\tCadastrado com sucesso!!\n");
            }

            break;


        case 7:

            //Listar???

            break;

        }

    }
    while (opcao != 8);

    return 0;
}


void ImprimeTelaDeOpcoes()
{

    printf("\n\t1-Carregar dados do Arquivo\n");
    printf("\t2-Exibir a quantidade total de leite produzido por semana\n");
    printf("\t3-Exibir a quantidade total de alimento consumido por semana\n");
    printf("\t4-Exibir a quantidade total de leite que vai ser produzido por semana na fazenda, após o abate \n");
    printf("\t5-Exibir o número de cabecas de gado que irao para o abate \n");
    printf("\t6-Incluir novo registro\n");
    printf("\t7-Listar registros\n");
    printf("\t8-Sair\n");

}

int EscolheOpcao()
{
    int op;

    printf("\n\tOpcao: ");
    scanf("%d",&op);

    return op;
}


int carregarArquivos(FILE *arq)
{

    int totalCadastrados=0;
    char ch;
    int i;

    arq = fopen("Gados.txt", "r");

    if(arq == NULL)
    {

        printf("\n\tErro ao Abrir!!\n");
        return;
    }

    while((ch=fgetc(arq))!= EOF )
    {

      if(ch == '\n')

         totalCadastrados++;
    }

    fseek(arq,0, SEEK_SET);

    if(totalCadastrados > 0)
    {

        while((ch=fgetc(arq))!= EOF )
        {

            printf("%c",ch);

        }
        return 1;
    }

    fclose(arq);

    return 0;
}


int incluirGados(FILE *arq, Gado *g)
{
    int totalCadastrados =0,totalAnos=0,i;
    char ch;


    arq = fopen("Gados.txt", "a+");

    if(arq == NULL)
    {
        printf("\n\tErro ao Gravar\n");
    }

    while((ch=fgetc(arq))!= EOF )
    {

      if(ch == '\n')

         totalCadastrados++;
    }


    if(totalCadastrados == (TAM*5))
    {

        return 1;

    }

    printf("\n\tInforme o codigo: ");
    scanf("%d",&(*g).codigo);

    printf("\tInforme o litro de Leite /Semana: ");
    scanf("%d",&(*g).qtdLeite);

    printf("\tInforme a quantidade KG de Alimento /Semana: ");
    scanf("%d",&(*g).qtdAlim);

    printf("\tInforme a data de nascimento MM/AAAA: ");
    scanf("%d %d",&(*g).nasc.mes, &(*g).nasc.ano );


    totalAnos = (2016 - (*g).nasc.ano);

      if(totalAnos > 5 || (*g).qtdLeite < 40 || ( (*g).qtdLeite >=50 || (*g).qtdLeite <=70 && (*g).qtdAlim > 50 ) ){

        (*g).abate = 's';

      }else{

        (*g).abate = 'n';

      }

    for(i=0; i < 1; i++)
    {

        fprintf(arq,"\n\tCodigo: %d ",(*g).codigo);
        fprintf(arq,"\n\tQuantidade de Leite: %d ",(*g).qtdLeite);
        fprintf(arq,"\n\tQuantidade de Alimento: %d ",(*g).qtdAlim);
        fprintf(arq,"\n\tAbate: %c ",(*g).abate);
        fprintf(arq,"\n\tData de nascimento: %d/%d\n",(*g).nasc.mes, (*g).nasc.ano);

    }

    fclose(arq);
}

int imprimeQtdLeitePorSemana(FILE *arq, Gado *g){


char gados[TAM];
int i=0;
    arq = fopen("Gados.txt", "r");

    if(arq == NULL)
    {

        printf("\n\tErro ao Abrir!!\n");
        return;
    }

        while((fgets(gados, sizeof(int), arq))!=NULL)
        {

                gados[i] = (*g).codigo;
                printf("%d",gados[i]);

                    i++;
        }

fclose(arq);



}


int imprimeQtdAlimentoPorSemana(FILE *arq, Gado *g){




}

int imprimeQtdLeitePosAbate(FILE *arq, Gado *g){




}

int imprimeNumeroCabecasPosAbate(FILE *arq, Gado *g){


}
