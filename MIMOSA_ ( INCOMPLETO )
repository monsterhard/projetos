#include<stdio.h>
#include<string.h>
#include<stdbool.h>
#define TAM 9
typedef struct
{
    int mes,ano;

} Nascimento;

typedef struct
{

    int codigo;
    int qtdLeite;
    int qtdAlim;
    char abate;
    Nascimento nasc;

} Gado;

int main ()
{

    Gado gados[TAM];
    Gado g;
    int opcao,qtdGados=0;
    Nascimento n;
    FILE *arq;
    int cont =1;

    ImprimeTelaDeOpcoes();

    do
    {
        opcao = EscolheOpcao();

        switch (opcao)
        {


        case 1:

            carregarArquivos(&arq,gados);

            break;

        case 2:

            break;

        case 3:

            break;

        case 4:

            break;

        case 5:

            break;

        case 6:

            incluirGados(&arq,&g,gados,qtdGados);


            break;


        case 7:

            break;

        }

    }
    while (opcao != 8);

    return 0;
}


void ImprimeTelaDeOpcoes()
{

    printf("\n\t1-Carregar dados do Arquivo\n");
    printf("\t2-Exibir a quantidade total de leite produzido por semana\n");
    printf("\t3-Exibir a quantidade total de alimento consumido por semana\n");
    printf("\t4-Exibir a quantidade total de leite que vai ser produzido por semana na fazenda, após o abate \n");
    printf("\t5-Exibir o número de cabecas de gado que irao para o abate \n");
    printf("\t6-Incluir novo registro\n");
    printf("\t7-Listar registros\n");
    printf("\t8-Sair\n");

}

int EscolheOpcao()
{
    int op;

    printf("\n\tOpcao: ");
    scanf("%d",&op);

    return op;
}


void carregarArquivos(FILE *arq, Gado gados[])
{



    arq = fopen("Gados.dat", "rb");

    if(arq == NULL)
    {

        printf("\n\tErro ao Abrir!!\n");
        return;
    }
    int result =0;

    fflush(stdin);

    result = fread(&gados[0],sizeof(Gado),TAM,arq);
    printf("%d",result);
    int i=0;
    if(result > 0)
    {

        printf("\n\tLista de Gados\n");

        for(i=0; i < result; i++)
        {

            printf("\n\tCodigo: %d ",gados[i].codigo);
            printf("\n\tQuantidade de Leite: %d ",gados[i].qtdLeite);
            printf("\n\tQuantidade de Alimento: %d ",gados[i].qtdAlim);
            printf("\n\tData de nascimento: %d/%d\n",gados[i].nasc.mes,gados[i].nasc.ano);


        }

    }
    else
    {

        printf("\n\tNao ha registros\n");
    }








}


void incluirGados(FILE *arq, Gado *g,Gado gados[],int qtd)
{

    arq = fopen("Gados.txt", "a+");

    if(arq == NULL)
    {

        printf("\n\tErro ao Gravar\n");

    }
    char ch;
    int cont=0;

    fseek(arq, 0, SEEK_SET);

    while((ch=fgetc(arq))!= EOF )
    {
        if(ch == '\n')

            cont++;
    }

    if(cont > TAM){

        return 1;
    }

    printf("\n\tInforme o codigo: ");
    scanf("%d",&(*g).codigo);

    printf("\tInforme a quantidade de Leite: ");
    scanf("%d",&(*g).qtdLeite);

    printf("\tInforme a quantidade de Alimento: ");
    scanf("%d",&(*g).qtdAlim);

    printf("\tInforme a data de nascimento: ");
    scanf("%d %d",&(*g).nasc.mes, &(*g).nasc.ano );

    gados[qtd] = *g;

    //int result =0;
    fwrite(&gados[0], sizeof(Gado),5,arq);

    // cont++;
    /*int i;
         for(i=0;i < result;i++){

                 printf("\n\tCodigo: %d ",gados[i].codigo);
                 printf("\n\tQuantidade de Leite: %d ",gados[i].qtdLeite);
                 printf("\n\tQuantidade de Alimento: %d ",gados[i].qtdAlim);
                 printf("\n\tData de nascimento: %d/%d\n",gados[i].nasc.mes,gados[i].nasc.ano);



         }*/

    fclose(arq);

}
